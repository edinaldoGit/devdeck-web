import{G as A,r as d,u as S,s as b,H as E,q as u}from"./index-G_Ayme-S.js";const T=A("admin",()=>{const t=d([]),s=d([]),l=d(!1),m=d(1),v=d(1),o=S(),j=b(),p=E();async function g(e={}){l.value=!0;try{const{data:r}=await u.get("/admin/users",{params:e}),a=Array.isArray(r)?r:r.users||[];r.totalPages&&(m.value=r.totalPages);const n=j.user?.id;t.value=a.filter(c=>c.id!==n)}catch(r){console.error(r),o.error("Erro ao carregar usuários")}finally{l.value=!1}}async function y(e){if(await p.open({title:"Banir Usuário",message:"Tem certeza que deseja banir este usuário? Todos os projetos dele também serão removidos.",confirmText:"Sim, Banir",isDestructive:!0}))try{await u.delete(`/admin/users/${e}`),t.value=t.value.filter(a=>a.id!==e),o.success("Usuário banido.")}catch{o.error("Erro ao banir usuário.")}}async function P(e,r){const a=r==="admin"?"dev":"admin",n=a==="admin"?"Promover":"Rebaixar";if(await p.open({title:`${n} Usuário`,message:`Confirmar alteração para ${a.toUpperCase()}?`,confirmText:"Confirmar",isDestructive:!1}))try{const{data:i}=await u.patch(`/admin/users/${e}/role`,{role:a}),f=t.value.findIndex(U=>U.id===e);f!==-1&&(t.value[f]={...t.value[f],role:i.role}),o.success("Cargo atualizado!")}catch{o.error("Erro ao alterar cargo.")}}async function h(e={}){l.value=!0;try{const{data:r}=await u.get("/admin/projects",{params:e}),a=Array.isArray(r)?r:r.projects||[];r.totalPages&&(v.value=r.totalPages),s.value=a}catch(r){console.error(r),o.error("Erro ao carregar projetos")}finally{l.value=!1}}async function w(e){try{return await u.delete(`/admin/projects/${e}`),s.value=s.value.filter(r=>r.id!==e),o.success("Projeto removido com autoridade."),!0}catch{return o.error("Erro ao excluir projeto."),!1}}async function x(e,r){try{const{data:a}=await u.put(`/admin/projects/${e}`,r),n=s.value.findIndex(i=>i.id===e),c=s.value[n];if(n!==-1&&c){const i={...c,...a,user:c.user};s.value[n]=i}return o.success("Projeto atualizado pelo Admin!"),!0}catch(a){return console.error(a),o.error("Erro ao atualizar projeto."),!1}}return{users:t,projects:s,isLoading:l,totalPagesUsers:m,totalPagesProjects:v,fetchUsers:g,banUser:y,changeRole:P,fetchProjects:h,deleteProject:w,updateProject:x}});export{T as u};
